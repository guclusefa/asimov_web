<%- include('../layout/header') %>
    <div class="container-fluid bg-secondary py-5">
        <div class="container">
            <div>
                <h1 class="display-5 fw-bold text-primary">
                    <%= titre %>
                </h1>
                <hr>

                <div class="row">
                    <div class="col-lg-4 col-md-12  col-sm-12 col-12">
                        <div class="row">
                            <div class="col-12 mt-3">
                                <div class="form-floating">
                                    <select class="form-control select2" id="eleve" name="eleve" 
                                        onchange="location.href='/notes/fiche_eleve/'+this.value+'/0'"
                                        required>
                                        <option value="" disabled selected>Choisir un élève</option>
                                        <% lesEleves.forEach(function(unEleveListe){ %>
                                            <%
                                            if (typeof unEleve !='undefined' && unEleve.user_id == unEleveListe.user_id ) { 
                                                selected = "selected" 
                                            } else {
                                                selected = " "  
                                            }
                                            %>

                                            <option value="<%= unEleveListe.user_id %>" <%= selected %>>
                                                <%= unEleveListe.user_nom + ' ' + unEleveListe.user_prenom %>
                                            </option>
                                        <% })%>
                                    </select>
                                    <label class="required">Élève</label>
                                </div>
                            </div>
                        </div>

                        <% if (typeof unEleve !='undefined') { %>
                        <div class="card mt-3">
                            <div class="card-body">
                                <h5 class="card-title">Informations</h5>
                                <hr>
                                <h5 class="card-text my-4"><b>Nom : </b>
                                    <%= unEleve.user_nom %>
                                </h5>
                                <h5 class="card-text my-4"><b>Prénom : </b>
                                    <%= unEleve.user_prenom %>
                                </h5>
                                <h5 class="card-text my-4"><b>Date de naissance : </b>
                                    <%= unEleve.user_dateNaissance %>
                                        (<%= unEleve.user_age %>ans)
                                </h5>
                                <h5 class="card-text my-4"><b>Sexe : </b>
                                    <% if(unEleve.user_sexe=='F' ) { %>
                                        Féminin
                                        <% } else { %>Masculin<% } %>
                                </h5>
                                <h5 class="card-text my-4"><b>Tél : </b>
                                    <%= unEleve.user_tel%>
                                </h5>
                                <h5 class="card-text my-4"><b>Email : </b>
                                    <%= unEleve.user_mail %>
                                </h5>
                            </div>
                        </div>
                        <% } %>
                    </div>

                    <% if (typeof unEleve !='undefined') { %>
                    <div class="col-lg-8 col-md-12  col-sm-12 col-12">
                        <div class="row">
                            <div class="col-12 mt-3">
                                <div class="form-floating">
                                    <select class="form-control select2" id="classe" name="classe"
                                    onchange="location.href='/notes/fiche_eleve/<%= unEleve.user_id %>/'+this.value"
                                        required>
                                        <option value="" disabled selected>Choisir une classe</option>
                                        <% lesCursus.forEach(function(unCursusListe){ %>
                                            <%
                                            if (typeof unCursus !='undefined' && unCursus.cursus_id == unCursusListe.cursus_id ) { 
                                                selected = "selected" 
                                            } else {
                                                selected = " "  
                                            }
                                            %>
                                            <option value="<%= unCursusListe.cursus_id %>" <%= selected %>>
                                                <%= unCursusListe.classe_libelle %>
                                                    <%= unCursusListe.cursus_libelle %> (<%= unCursusListe.cursus_anneeScolaire %>)
                                            </option>
                                            <% })%>
                                    </select>
                                    <label class="required">Classe</label>
                                </div>
                            </div>
                        </div>

                        <% if (typeof unCursus !='undefined') { %>
                        <div class="card mt-3">
                            <div class="card-body">
                                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                                    <li class="nav-item">
                                        <button class="nav-link active lien-t" data-bs-toggle="pill"
                                            data-bs-target="#area-notes">Les notes</button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link lien-t" data-bs-toggle="pill"
                                            data-bs-target="#area-graphes">Les graphes</button>
                                    </li>
                                </ul>
                                <hr>
                                <div class="tab-content">
                                    <!-- notes -->
                                    <div class="tab-pane fade show active" id="area-notes">
                                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="lien nav-link active" data-bs-toggle="tab"
                                                    data-bs-target="#T1">Trimestre 1</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="lien nav-link" data-bs-toggle="tab"
                                                    data-bs-target="#T2">Trimestre 2</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="lien nav-link" data-bs-toggle="tab"
                                                    data-bs-target="#T3">Trimestre 3</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="lien nav-link" data-bs-toggle="tab"
                                                    data-bs-target="#T4">Annuel</button>
                                            </li>
                                        </ul>
                                        <div class="tab-content">
                                            <!-- les trimestres -->
                                            <div class="tab-pane fade show active" id="T1">
                                                <% if(bilanClasseT1.length > 0) {%>     
                                                    <div>
                                                        <!-- les cartes -->
                                                        <% lesMatieres.forEach(function(uneMatiere){ %>
                                                        <% if(uneMatiere.notesT1.length > 0) {%>                                                    
                                                        <div class="card border-1 border-1 my-4">
                                                            <div class="card-header text-primary fs-5">
                                                                <div>
                                                                    <%= uneMatiere.matiere_libelle %> (<%= uneMatiere.user_prenom[0] %>.<%= uneMatiere.user_nom %>)
                                                                    <span class="float-end ">
                                                                        <% if(typeof uneMatiere.bilanT1.eleve_avg == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT1.eleve_avg %>%
                                                                        <% } %>
                                                                    </span>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-12 col-lg-3 figure-caption">
                                                                        Moy: <% if(typeof uneMatiere.bilanT1.classe_avg == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT1.classe_avg %>%
                                                                        <% } %>
                                                                    </div>
                                                                    <div class="col-12 col-lg-3 figure-caption">
                                                                        Moy+: <% if(typeof uneMatiere.bilanT1.classe_max == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT1.classe_max %>%
                                                                        <% } %>
                                                                    </div>
                                                                    <div class="col-12 col-lg-3  figure-caption">
                                                                        Moy-: <% if(typeof uneMatiere.bilanT1.classe_min == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT1.classe_min %>%
                                                                        <% } %>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <ul class="list-group list-group-flush">
                                                                <% uneMatiere.notesT1.forEach(function(uneNote){ %>
                                                                    <li class="list-group-item "><%= uneNote.eval_date %> : <%= uneNote.eval_desc %>
                                                                        <span class=" float-end">
                                                                            <% if(uneNote.note_valeur == null) { %> Absent <% } else { %><%= uneNote.note_valeur %>%<% } %>
                                                                        </span>
                                                                        <div class="row">
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy:
                                                                                <% if(uneNote.eval_avg == null) { %> A definir <% } else { %> <%= (uneNote.eval_avg).toFixed(2) %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy+:
                                                                                <% if(uneNote.eval_max == null) { %> A definir <% } else { %> <%= uneNote.eval_max %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3  figure-caption">
                                                                                Moy-:
                                                                                <% if(uneNote.eval_min == null) { %> A definir <% } else { %> <%= uneNote.eval_min %>% <%} %>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                <% })%>
                                                            </ul>
                                                        </div>
                                                        <% } %>
                                                        <% })%>
    
                                                        <!-- fin des cartes -->
                                                        <div class="border border-1 py-1 ps-2">
                                                            <span class="mt-5">Moyenne élève : 
                                                                <% if (bilanClasseT1[0] == null){ %>
                                                                    A definir
                                                                <%}  else { %>
                                                                    <%= bilanClasseT1[0].toFixed(2) %>%
                                                                <% } %>
                                                            </span>
                                                        </div>
                                                        <div class="border border-1 py-1 ps-2 mt-3">
                                                            <span class="mt-5">Moyenne classe :
                                                                <% if (bilanClasseT1[1] == null){ %>
                                                                    A definir
                                                                <%}  else { %>
                                                                    <%= bilanClasseT1[1].toFixed(2) %>%
                                                                <% } %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <% } else { %>
                                                        <h1 class="mt-3 text-center">Aucune note pour ce trimestre</h1>
                                                    <% } %>
                                            </div>
                                            <div class="tab-pane fade" id="T2">
                                                <% if(bilanClasseT2.length > 0) {%>     
                                                    <div>
                                                        <!-- les cartes -->
                                                        <% lesMatieres.forEach(function(uneMatiere){ %>
                                                        <% if(uneMatiere.notesT2.length > 0) {%>                                                    
                                                        <div class="card border-1 border-1 my-4">
                                                            <div class="card-header text-primary fs-5">
                                                                <div>
                                                                    <%= uneMatiere.matiere_libelle %> (<%= uneMatiere.user_prenom[0] %>.<%= uneMatiere.user_nom %>)
                                                                    <span class="float-end ">
                                                                        <% if(typeof uneMatiere.bilanT2.eleve_avg == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT2.eleve_avg %>%
                                                                        <% } %>
                                                                    </span>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-12 col-lg-3 figure-caption">
                                                                        Moy: <% if(typeof uneMatiere.bilanT2.classe_avg == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT2.classe_avg %>%
                                                                        <% } %>
                                                                    </div>
                                                                    <div class="col-12 col-lg-3 figure-caption">
                                                                        Moy+: <% if(typeof uneMatiere.bilanT2.classe_max == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT2.classe_max %>%
                                                                        <% } %>
                                                                    </div>
                                                                    <div class="col-12 col-lg-3  figure-caption">
                                                                        Moy-: <% if(typeof uneMatiere.bilanT2.classe_min == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT2.classe_min %>%
                                                                        <% } %>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <ul class="list-group list-group-flush">
                                                                <% uneMatiere.notesT2.forEach(function(uneNote){ %>
                                                                    <li class="list-group-item "><%= uneNote.eval_date %> : <%= uneNote.eval_desc %>
                                                                        <span class=" float-end">
                                                                            <% if(uneNote.note_valeur == null) { %> Absent <% } else { %><%= uneNote.note_valeur %>%<% } %>
                                                                        </span>
                                                                        <div class="row">
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy:
                                                                                <% if(uneNote.eval_avg == null) { %> A definir <% } else { %> <%= (uneNote.eval_avg).toFixed(2) %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy+:
                                                                                <% if(uneNote.eval_max == null) { %> A definir <% } else { %> <%= uneNote.eval_max %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3  figure-caption">
                                                                                Moy-:
                                                                                <% if(uneNote.eval_min == null) { %> A definir <% } else { %> <%= uneNote.eval_min %>% <%} %>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                <% })%>
                                                            </ul>
                                                        </div>
                                                        <% } %>
                                                        <% })%>
    
                                                        <!-- fin des cartes -->
                                                        <div class="border border-1 py-1 ps-2">
                                                            <span class="mt-5">Moyenne élève : 
                                                                <% if (bilanClasseT2[0] == null){ %>
                                                                    A definir
                                                                <%}  else { %>
                                                                    <%= bilanClasseT2[0].toFixed(2) %>%
                                                                <% } %>
                                                            </span>
                                                        </div>
                                                        <div class="border border-1 py-1 ps-2 mt-3">
                                                            <span class="mt-5">Moyenne classe :
                                                                <% if (bilanClasseT2[1] == null){ %>
                                                                    A definir
                                                                <%}  else { %>
                                                                    <%= bilanClasseT2[1].toFixed(2) %>%
                                                                <% } %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <% } else { %>
                                                        <h1 class="mt-3 text-center">Aucune note pour ce trimestre</h1>
                                                    <% } %>
                                            </div>
                                            <div class="tab-pane fade" id="T3">
                                                <% if(bilanClasseT3.length > 0) {%>     
                                                    <div>
                                                        <!-- les cartes -->
                                                        <% lesMatieres.forEach(function(uneMatiere){ %>
                                                        <% if(uneMatiere.notesT3.length > 0) {%>                                                    
                                                        <div class="card border-1 border-1 my-4">
                                                            <div class="card-header text-primary fs-5">
                                                                <div>
                                                                    <%= uneMatiere.matiere_libelle %> (<%= uneMatiere.user_prenom[0] %>.<%= uneMatiere.user_nom %>)
                                                                    <span class="float-end ">
                                                                        <% if(typeof uneMatiere.bilanT3.eleve_avg == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT3.eleve_avg %>%
                                                                        <% } %>
                                                                    </span>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-12 col-lg-3 figure-caption">
                                                                        Moy: <% if(typeof uneMatiere.bilanT3.classe_avg == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT3.classe_avg %>%
                                                                        <% } %>
                                                                    </div>
                                                                    <div class="col-12 col-lg-3 figure-caption">
                                                                        Moy+: <% if(typeof uneMatiere.bilanT3.classe_max == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT3.classe_max %>%
                                                                        <% } %>
                                                                    </div>
                                                                    <div class="col-12 col-lg-3  figure-caption">
                                                                        Moy-: <% if(typeof uneMatiere.bilanT3.classe_min == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT3.classe_min %>%
                                                                        <% } %>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <ul class="list-group list-group-flush">
                                                                <% uneMatiere.notesT3.forEach(function(uneNote){ %>
                                                                    <li class="list-group-item "><%= uneNote.eval_date %> : <%= uneNote.eval_desc %>
                                                                        <span class=" float-end">
                                                                            <% if(uneNote.note_valeur == null) { %> Absent <% } else { %><%= uneNote.note_valeur %>%<% } %>
                                                                        </span>
                                                                        <div class="row">
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy:
                                                                                <% if(uneNote.eval_avg == null) { %> A definir <% } else { %> <%= (uneNote.eval_avg).toFixed(2) %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy+:
                                                                                <% if(uneNote.eval_max == null) { %> A definir <% } else { %> <%= uneNote.eval_max %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3  figure-caption">
                                                                                Moy-:
                                                                                <% if(uneNote.eval_min == null) { %> A definir <% } else { %> <%= uneNote.eval_min %>% <%} %>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                <% })%>
                                                            </ul>
                                                        </div>
                                                        <% } %>
                                                        <% })%>
    
                                                        <!-- fin des cartes -->
                                                        <div class="border border-1 py-1 ps-2">
                                                            <span class="mt-5">Moyenne élève : 
                                                                <% if (bilanClasseT3[0] == null){ %>
                                                                    A definir
                                                                <%}  else { %>
                                                                    <%= bilanClasseT3[0].toFixed(2) %>%
                                                                <% } %>
                                                            </span>
                                                        </div>
                                                        <div class="border border-1 py-1 ps-2 mt-3">
                                                            <span class="mt-5">Moyenne classe :
                                                                <% if (bilanClasseT3[1] == null){ %>
                                                                    A definir
                                                                <%}  else { %>
                                                                    <%= bilanClasseT3[1].toFixed(2) %>%
                                                                <% } %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <% } else { %>
                                                        <h1 class="mt-3 text-center">Aucune note pour ce trimestre</h1>
                                                    <% } %>
                                            </div>
                                            <div class="tab-pane fade" id="T4">
                                                <% if(bilanClasseT1.length > 0 || bilanClasseT2.length > 0 || bilanClasseT3.length > 0 ) {%>     
                                                    <div>
                                                        <!-- les cartes -->
                                                        <% lesMatieres.forEach(function(uneMatiere){ %>
                                                        <% if(uneMatiere.notesT1.length > 0 || uneMatiere.notesT2.length > 0 || uneMatiere.notesT3.length > 0) {%>                                                    
                                                        <div class="card border-1 border-1 my-4">
                                                            <div class="card-header text-primary fs-5">
                                                                <div>
                                                                    <%= uneMatiere.matiere_libelle %> (<%= uneMatiere.user_prenom[0] %>.<%= uneMatiere.user_nom %>)
                                                                    <span class="float-end ">
                                                                        <% if (typeof uneMatiere.bilanT4.eleve_avg == 'undefined') { %>
                                                                            A definir
                                                                        <%}  else { %>
                                                                            <%= (uneMatiere.bilanT4.eleve_avg).toFixed(2) %>%
                                                                        <% } %>
                                                                    </span>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-12 col-lg-3 figure-caption">
                                                                        Moy: 
                                                                        <% if(typeof uneMatiere.bilanT4.classe_avg == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT4.classe_avg %>%
                                                                        <% } %>
                                                                    </div>
                                                                    <div class="col-12 col-lg-3 figure-caption">
                                                                        Moy+: 
                                                                        <% if(typeof uneMatiere.bilanT4.classe_max == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT4.classe_max %>%
                                                                        <% } %>
                                                                    </div>
                                                                    <div class="col-12 col-lg-3  figure-caption">
                                                                        Moy-:
                                                                        <% if(typeof uneMatiere.bilanT4.classe_min == 'undefined') { %>
                                                                            A definir
                                                                        <% } else { %>
                                                                            <%= uneMatiere.bilanT4.classe_min %>%
                                                                        <% } %> 
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <ul class="list-group list-group-flush">
                                                                <% uneMatiere.notesT1.forEach(function(uneNote){ %>
                                                                    <li class="list-group-item "><%= uneNote.eval_date %> : <%= uneNote.eval_desc %>
                                                                        <span class=" float-end">
                                                                            <% if(uneNote.note_valeur == null) { %> Absent <% } else { %><%= uneNote.note_valeur %>%<% } %>
                                                                        </span>
                                                                        <div class="row">
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy:
                                                                                <% if(uneNote.eval_avg == null) { %> A definir <% } else { %> <%= (uneNote.eval_avg).toFixed(2) %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy+:
                                                                                <% if(uneNote.eval_max == null) { %> A definir <% } else { %> <%= uneNote.eval_max %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3  figure-caption">
                                                                                Moy-:
                                                                                <% if(uneNote.eval_min == null) { %> A definir <% } else { %> <%= uneNote.eval_min %>% <%} %>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                <% })%>
                                                                <% uneMatiere.notesT2.forEach(function(uneNote){ %>
                                                                    <li class="list-group-item "><%= uneNote.eval_date %> : <%= uneNote.eval_desc %>
                                                                        <span class=" float-end">
                                                                            <% if(uneNote.note_valeur == null) { %> Absent <% } else { %><%= uneNote.note_valeur %>%<% } %>
                                                                        </span>
                                                                        <div class="row">
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy:
                                                                                <% if(uneNote.eval_avg == null) { %> A definir <% } else { %> <%= uneNote.eval_avg %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy+:
                                                                                <% if(uneNote.eval_max == null) { %> A definir <% } else { %> <%= uneNote.eval_max %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3  figure-caption">
                                                                                Moy-:
                                                                                <% if(uneNote.eval_min == null) { %> A definir <% } else { %> <%= uneNote.eval_min %>% <%} %>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                <% })%>
                                                                <% uneMatiere.notesT3.forEach(function(uneNote){ %>
                                                                    <li class="list-group-item "><%= uneNote.eval_date %> : <%= uneNote.eval_desc %>
                                                                        <span class=" float-end">
                                                                            <% if(uneNote.note_valeur == null) { %> Absent <% } else { %><%= uneNote.note_valeur %>%<% } %>
                                                                        </span>
                                                                        <div class="row">
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy:
                                                                                <% if(uneNote.eval_avg == null) { %> A definir <% } else { %> <%= (uneNote.eval_avg).toFixed(2) %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3 figure-caption">
                                                                                Moy+:
                                                                                <% if(uneNote.eval_max == null) { %> A definir <% } else { %> <%= uneNote.eval_max %>% <%} %>
                                                                            </div>
                                                                            <div class="col-12 col-lg-3  figure-caption">
                                                                                Moy-:
                                                                                <% if(uneNote.eval_min == null) { %> A definir <% } else { %> <%= uneNote.eval_min %>% <%} %>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                <% })%>
                                                            </ul>
                                                        </div>
                                                        <% } %>
                                                        <% })%>
    
                                                        <!-- fin des cartes -->
                                                        <div class="border border-1 py-1 ps-2">
                                                            <span class="mt-5">Moyenne élève : 
                                                                <% if (bilanClasseT4[0] == null){ %>
                                                                    A definir
                                                                <%}  else { %>
                                                                    <%= bilanClasseT4[0].toFixed(2) %>%
                                                                <% } %>
                                                            </span>
                                                        </div>
                                                        <div class="border border-1 py-1 ps-2 mt-3">
                                                            <span class="mt-5">Moyenne classe :
                                                                <% if (bilanClasseT4[1] == null){ %>
                                                                    A definir
                                                                <%}  else { %>
                                                                    <%= bilanClasseT4[1].toFixed(2) %>%
                                                                <% } %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <% } else { %>
                                                        <h1 class="mt-3 text-center">Aucune note pour cette année</h1>
                                                    <% } %>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- graphes -->
                                    <div class="tab-pane fade" id="area-graphes">
                                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="lien nav-link active" data-bs-toggle="tab"
                                                    data-bs-target="#T1-2">Trimestre 1</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="lien nav-link" data-bs-toggle="tab"
                                                    data-bs-target="#T2-2">Trimestre 2</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="lien nav-link" data-bs-toggle="tab"
                                                    data-bs-target="#T3-2">Trimestre 3</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="lien nav-link" data-bs-toggle="tab"
                                                    data-bs-target="#T4-2">Annuel</button>
                                            </li>
                                        </ul>
                                        <div class="tab-content">
                                            <!-- les trimestres -->
                                            <div class="tab-pane fade show active" id="T1-2">
                                                <% if(bilanClasseT1.length > 0) {  
                                                    labels = []
                                                    notesEleve = []
                                                    notesClasse = []
                                                    lesMatieres.forEach(function(uneMatiere){ 
                                                        if(uneMatiere.notesT1.length > 0) { 
                                                            labels.push(uneMatiere.matiere_libelle)
                                                            if (uneMatiere.bilanT1.eleve_avg == null ){
                                                                notesEleve.push(0)
                                                            } else {
                                                                notesEleve.push(uneMatiere.bilanT1.eleve_avg)
                                                            }
                                                            if (uneMatiere.bilanT1.classe_avg == null ){
                                                                notesClasse.push(0)
                                                            } else {
                                                                notesClasse.push(uneMatiere.bilanT1.classe_avg)
                                                            }
                                                        } 
                                                    })
                                                %>
                                                <% if(labels.length > 3) { %>
                                                <script>
                                                    window.addEventListener("load", function () {
                                                        var marksCanvas = document.getElementById("chartT1");
                                                        var lesLabels = JSON.parse('<%- JSON.stringify(labels) %>')
                                                        var dataEleve = JSON.parse('<%- JSON.stringify(notesEleve) %>')
                                                        var dataClasse = JSON.parse('<%- JSON.stringify(notesClasse) %>')

                                                        var radarChart = new Chart(marksCanvas, {
                                                            type: 'radar',
                                                            data: {
                                                                labels: lesLabels,
                                                                datasets: [{
                                                                    label: "Moyenne de l'élève",
                                                                    data: dataEleve,
                                                                    fill: true,
                                                                    backgroundColor: 'rgb(186, 186, 186, 0.2)',
                                                                    borderColor: 'rgb(186, 186, 186)',
                                                                    pointBackgroundColor: 'rgb(186, 186, 186)',
                                                                    pointBorderColor: '#fff',
                                                                    pointHoverBackgroundColor: '#fff',
                                                                    pointHoverBorderColor: 'rgb(186, 186, 186)'
                                                                }, 
                                                                {
                                                                    label: "Moyenne de la classe",
                                                                    data: dataClasse,
                                                                    fill: true,
                                                                    backgroundColor: 'rgba(60, 75, 100, 0.2)',
                                                                    borderColor: 'rgb(60, 75, 100)',
                                                                    pointBackgroundColor: 'rgb(60, 75, 100)',
                                                                    pointBorderColor: '#fff',
                                                                    pointHoverBackgroundColor: '#fff',
                                                                    pointHoverBorderColor: 'rgb(60, 75, 100)'
                                                                }]
                                                            },
                                                            options: {
                                                                scales: {
                                                                    r: {
                                                                    angleLines: {
                                                                        display: false
                                                                    },
                                                                    suggestedMin: 0,
                                                                    suggestedMax: 100
                                                                    }
                                                                }
                                                            }
                                                        });
                                                    });
                                                </script>
                                                <div class="monchart">
                                                    <canvas id="chartT1"></canvas>
                                                </div>
                                                <% } else { %>
                                                    <h1 class="mt-3 text-center">Pas assez de notes pour ce trimestre</h1>
                                                    <p class="mt-3 text-center text-primary">Ayez au moins 1 note dans 4 matières diffèrentes afin d'avoir une representation graphique</p>
                                                <% }%>
                                                <% } else { %><h1 class="mt-3 text-center">Aucune note pour ce trimestre</h1><% }%>
                                            </div>
                                            <div class="tab-pane fade" id="T2-2">
                                                <% if(bilanClasseT2.length > 0) {  
                                                    labels = []
                                                    notesEleve = []
                                                    notesClasse = []
                                                    lesMatieres.forEach(function(uneMatiere){ 
                                                        if(uneMatiere.notesT2.length > 0) { 
                                                            labels.push(uneMatiere.matiere_libelle)
                                                            if (uneMatiere.bilanT2.eleve_avg == null ){
                                                                notesEleve.push(0)
                                                            } else {
                                                                notesEleve.push(uneMatiere.bilanT2.eleve_avg)
                                                            }
                                                            if (uneMatiere.bilanT2.classe_avg == null ){
                                                                notesClasse.push(0)
                                                            } else {
                                                                notesClasse.push(uneMatiere.bilanT2.classe_avg)
                                                            }
                                                        } 
                                                    })
                                                %>
                                                <% if(labels.length > 3) { %>
                                                <script>
                                                    window.addEventListener("load", function () {
                                                        var marksCanvas = document.getElementById("chartT2");
                                                        var lesLabels = JSON.parse('<%- JSON.stringify(labels) %>')
                                                        var dataEleve = JSON.parse('<%- JSON.stringify(notesEleve) %>')
                                                        var dataClasse = JSON.parse('<%- JSON.stringify(notesClasse) %>')

                                                        var radarChart = new Chart(marksCanvas, {
                                                            type: 'radar',
                                                            data: {
                                                                labels: lesLabels,
                                                                datasets: [{
                                                                    label: "Moyenne de l'élève",
                                                                    data: dataEleve,
                                                                    fill: true,
                                                                    backgroundColor: 'rgb(186, 186, 186, 0.2)',
                                                                    borderColor: 'rgb(186, 186, 186)',
                                                                    pointBackgroundColor: 'rgb(186, 186, 186)',
                                                                    pointBorderColor: '#fff',
                                                                    pointHoverBackgroundColor: '#fff',
                                                                    pointHoverBorderColor: 'rgb(186, 186, 186)'
                                                                }, 
                                                                {
                                                                    label: "Moyenne de la classe",
                                                                    data: dataClasse,
                                                                    fill: true,
                                                                    backgroundColor: 'rgba(60, 75, 100, 0.2)',
                                                                    borderColor: 'rgb(60, 75, 100)',
                                                                    pointBackgroundColor: 'rgb(60, 75, 100)',
                                                                    pointBorderColor: '#fff',
                                                                    pointHoverBackgroundColor: '#fff',
                                                                    pointHoverBorderColor: 'rgb(60, 75, 100)'
                                                                }]
                                                            },
                                                            options: {
                                                                scales: {
                                                                    r: {
                                                                    angleLines: {
                                                                        display: false
                                                                    },
                                                                    suggestedMin: 0,
                                                                    suggestedMax: 100
                                                                    }
                                                                }
                                                            }
                                                        });
                                                    });
                                                </script>
                                                <div class="monchart">
                                                    <canvas id="chartT2"></canvas>
                                                </div>
                                                <% } else { %>
                                                    <h1 class="mt-3 text-center">Pas assez de notes pour ce trimestre</h1>
                                                    <p class="mt-3 text-center text-primary">Ayez au moins 1 note dans 4 matières diffèrentes afin d'avoir une representation graphique</p>
                                                <% }%>
                                                <% } else { %><h1 class="mt-3 text-center">Aucune note pour ce trimestre</h1><% }%>
                                            </div>
                                            <div class="tab-pane fade" id="T3-2">
                                                <% if(bilanClasseT3.length > 0) {  
                                                    labels = []
                                                    notesEleve = []
                                                    notesClasse = []
                                                    lesMatieres.forEach(function(uneMatiere){ 
                                                        if(uneMatiere.notesT3.length > 0) { 
                                                            labels.push(uneMatiere.matiere_libelle)
                                                            if (uneMatiere.bilanT3.eleve_avg == null ){
                                                                notesEleve.push(0)
                                                            } else {
                                                                notesEleve.push(uneMatiere.bilanT3.eleve_avg)
                                                            }
                                                            if (uneMatiere.bilanT3.classe_avg == null ){
                                                                notesClasse.push(0)
                                                            } else {
                                                                notesClasse.push(uneMatiere.bilanT3.classe_avg)
                                                            }
                                                        } 
                                                    })
                                                %>
                                                <% if(labels.length > 3) { %>
                                                <script>
                                                    window.addEventListener("load", function () {
                                                        var marksCanvas = document.getElementById("chartT3");
                                                        var lesLabels = JSON.parse('<%- JSON.stringify(labels) %>')
                                                        var dataEleve = JSON.parse('<%- JSON.stringify(notesEleve) %>')
                                                        var dataClasse = JSON.parse('<%- JSON.stringify(notesClasse) %>')

                                                        var radarChart = new Chart(marksCanvas, {
                                                            type: 'radar',
                                                            data: {
                                                                labels: lesLabels,
                                                                datasets: [{
                                                                    label: "Moyenne de l'élève",
                                                                    data: dataEleve,
                                                                    fill: true,
                                                                    backgroundColor: 'rgb(186, 186, 186, 0.2)',
                                                                    borderColor: 'rgb(186, 186, 186)',
                                                                    pointBackgroundColor: 'rgb(186, 186, 186)',
                                                                    pointBorderColor: '#fff',
                                                                    pointHoverBackgroundColor: '#fff',
                                                                    pointHoverBorderColor: 'rgb(186, 186, 186)'
                                                                }, 
                                                                {
                                                                    label: "Moyenne de la classe",
                                                                    data: dataClasse,
                                                                    fill: true,
                                                                    backgroundColor: 'rgba(60, 75, 100, 0.2)',
                                                                    borderColor: 'rgb(60, 75, 100)',
                                                                    pointBackgroundColor: 'rgb(60, 75, 100)',
                                                                    pointBorderColor: '#fff',
                                                                    pointHoverBackgroundColor: '#fff',
                                                                    pointHoverBorderColor: 'rgb(60, 75, 100)'
                                                                }]
                                                            },
                                                            options: {
                                                                scales: {
                                                                    r: {
                                                                    angleLines: {
                                                                        display: false
                                                                    },
                                                                    suggestedMin: 0,
                                                                    suggestedMax: 100
                                                                    }
                                                                }
                                                            }
                                                        });
                                                    });
                                                </script>
                                                <div class="monchart">
                                                    <canvas id="chartT3"></canvas>
                                                </div>
                                                <% } else { %>
                                                    <h1 class="mt-3 text-center">Pas assez de notes pour ce trimestre</h1>
                                                    <p class="mt-3 text-center text-primary">Ayez au moins 1 note dans 4 matières diffèrentes afin d'avoir une representation graphique</p>
                                                <% }%>
                                                <% } else { %><h1 class="mt-3 text-center">Aucune note pour ce trimestre</h1><% }%>
                                            </div>
                                            <div class="tab-pane fade" id="T4-2">
                                                <% if(bilanClasseT1.length > 0 || bilanClasseT2.length > 0 || bilanClasseT3.length > 0 ) {
                                                    labels = []
                                                    notesEleve = []
                                                    notesClasse = []
                                                    lesMatieres.forEach(function(uneMatiere){ 
                                                        if(uneMatiere.notesT1.length > 0 || uneMatiere.notesT2.length > 0 || uneMatiere.notesT3.length > 0) {
                                                            labels.push(uneMatiere.matiere_libelle)
                                                            if (uneMatiere.bilanT4.eleve_avg == null ){
                                                                notesEleve.push(0)
                                                            } else {
                                                                notesEleve.push(uneMatiere.bilanT4.eleve_avg)
                                                            }
                                                            if (uneMatiere.bilanT4.classe_avg == null ){
                                                                notesClasse.push(0)
                                                            } else {
                                                                notesClasse.push(uneMatiere.bilanT4.classe_avg)
                                                            }
                                                        } 
                                                    })
                                                %>
                                                <% if(labels.length > 3) { %>
                                                <script>
                                                    window.addEventListener("load", function () {
                                                        var marksCanvas = document.getElementById("chartT4");
                                                        var lesLabels = JSON.parse('<%- JSON.stringify(labels) %>')
                                                        var dataEleve = JSON.parse('<%- JSON.stringify(notesEleve) %>')
                                                        var dataClasse = JSON.parse('<%- JSON.stringify(notesClasse) %>')

                                                        var radarChart = new Chart(marksCanvas, {
                                                            type: 'radar',
                                                            data: {
                                                                labels: lesLabels,
                                                                datasets: [{
                                                                    label: "Moyenne de l'élève",
                                                                    data: dataEleve,
                                                                    fill: true,
                                                                    backgroundColor: 'rgb(186, 186, 186, 0.2)',
                                                                    borderColor: 'rgb(186, 186, 186)',
                                                                    pointBackgroundColor: 'rgb(186, 186, 186)',
                                                                    pointBorderColor: '#fff',
                                                                    pointHoverBackgroundColor: '#fff',
                                                                    pointHoverBorderColor: 'rgb(186, 186, 186)'
                                                                }, 
                                                                {
                                                                    label: "Moyenne de la classe",
                                                                    data: dataClasse,
                                                                    fill: true,
                                                                    backgroundColor: 'rgba(60, 75, 100, 0.2)',
                                                                    borderColor: 'rgb(60, 75, 100)',
                                                                    pointBackgroundColor: 'rgb(60, 75, 100)',
                                                                    pointBorderColor: '#fff',
                                                                    pointHoverBackgroundColor: '#fff',
                                                                    pointHoverBorderColor: 'rgb(60, 75, 100)'
                                                                }]
                                                            },
                                                            options: {
                                                                scales: {
                                                                    r: {
                                                                    angleLines: {
                                                                        display: false
                                                                    },
                                                                    suggestedMin: 0,
                                                                    suggestedMax: 100
                                                                    }
                                                                }
                                                            }
                                                        });
                                                    });
                                                </script>
                                                <div class="monchart">
                                                    <canvas id="chartT4"></canvas>
                                                </div>
                                                <% } else { %>
                                                    <h1 class="mt-3 text-center">Pas assez de notes pour cette année</h1>
                                                    <p class="mt-3 text-center text-primary">Ayez au moins 1 note dans 4 matières diffèrentes afin d'avoir une representation graphique</p>
                                                <% }%>
                                                <% } else { %><h1 class="mt-3 text-center">Aucune note pour cette année</h1><% }%>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% } %>
                    </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    <%- include('../layout/footer') %>